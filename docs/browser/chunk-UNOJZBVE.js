import{A as ke,B as Be,C as Ge,a as Z,b as ee,c as te,d as j,e as ge,f as H,g as he,h as Ce,i as ve,j as Se,k as Me,l as xe,m as be,n as Ee,o as Ue,p as ye,q as De,r as Ie,s as Te,t as we,u as Fe,v as Le,w as Re,x as Pe,y as Oe,z as Ne}from"./chunk-MB63AH5V.js";import"./chunk-YMJQEMCG.js";import{a as $,b as Q,c as Y}from"./chunk-TZWS5AQ3.js";import{$a as y,Ab as de,Bb as R,Cb as P,Da as J,Ea as K,Fa as X,G as v,H as S,Ha as o,Ia as E,Ja as M,Ma as me,Na as le,Vc as z,W as l,Wa as se,Ya as U,Zb as ce,_ as c,a as oe,aa as b,bc as O,dc as N,fa as p,ha as s,lb as pe,lc as ue,mc as k,nc as fe,qa as r,qb as D,ra as i,rb as C,s as ae,sa as u,sc as B,ta as _,tb as I,tc as G,ua as g,ub as T,uc as _e,vc as V,wa as W,wb as w,ya as f,yb as F,yc as A,za as h,zb as L,zc as q}from"./chunk-TLH5L5OP.js";function Ze(e,t){e&1&&(r(0,"mat-error"),o(1," Il nome \xE8 richiesto "),i())}function et(e,t){e&1&&(r(0,"mat-error"),o(1," L'email \xE8 richiesta "),i())}function tt(e,t){e&1&&(r(0,"mat-error"),o(1," Inserisci un indirizzo email valido "),i())}function it(e,t){e&1&&(r(0,"mat-error"),o(1," Il genere \xE8 richiesto "),i())}function rt(e,t){e&1&&(r(0,"mat-error"),o(1," Lo status \xE8 richiesto "),i())}function nt(e,t){e&1&&u(0,"mat-spinner",16)}function ot(e,t){e&1&&(r(0,"span"),o(1,"Salva"),i())}var x=class e{constructor(t,n,a,m,d){this.fb=t;this.userService=n;this.snackBar=a;this.dialogRef=m;this.data=d}userForm;isSubmitting=!1;ngOnInit(){this.initForm()}initForm(){this.userForm=this.fb.group({name:[this.data.user?.name||"",[C.required]],email:[this.data.user?.email||"",[C.required,C.email]],gender:[this.data.user?.gender||"male",[C.required]],status:[this.data.user?.status||"active",[C.required]]})}onSubmit(){if(this.userForm.invalid)return;this.isSubmitting=!0;let t=this.userForm.value;if(this.data.user?.id){let n=t;this.userService.updateUser(this.data.user.id,n).subscribe({next:()=>{this.snackBar.open("Utente aggiornato con successo","Chiudi",{duration:3e3}),this.dialogRef.close(!0)},error:a=>this.handleError(a)})}else{let n={name:t.name,email:t.email,gender:t.gender,status:t.status};this.userService.createUser(n).subscribe({next:()=>{this.snackBar.open("Utente creato con successo","Chiudi",{duration:3e3}),this.dialogRef.close(!0)},error:a=>this.handleError(a)})}}handleError(t){console.error("Errore durante il salvataggio dell'utente",t),this.isSubmitting=!1,this.snackBar.open("Errore durante il salvataggio dell'utente: "+(t.error?.message||"Errore sconosciuto"),"Chiudi",{duration:5e3})}static \u0275fac=function(n){return new(n||e)(c(R),c(Y),c(z),c(Le),c(Re))};static \u0275cmp=b({type:e,selectors:[["app-user-dialog"]],decls:39,vars:10,consts:[["mat-dialog-title",""],[3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","name","placeholder","Inserisci il nome","required",""],[4,"ngIf"],["matInput","","formControlName","email","placeholder","Inserisci l'email","required",""],["formControlName","gender","required",""],["value","male"],["value","female"],["formControlName","status","required",""],["value","active"],["value","inactive"],["align","end"],["mat-button","","mat-dialog-close","","type","button"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20","class","spinner-button",4,"ngIf"],["diameter","20",1,"spinner-button"]],template:function(n,a){if(n&1&&(r(0,"h2",0),o(1),i(),r(2,"form",1),f("ngSubmit",function(){return a.onSubmit()}),r(3,"mat-dialog-content")(4,"mat-form-field",2)(5,"mat-label"),o(6,"Nome"),i(),u(7,"input",3),p(8,Ze,2,0,"mat-error",4),i(),r(9,"mat-form-field",2)(10,"mat-label"),o(11,"Email"),i(),u(12,"input",5),p(13,et,2,0,"mat-error",4)(14,tt,2,0,"mat-error",4),i(),r(15,"mat-form-field",2)(16,"mat-label"),o(17,"Genere"),i(),r(18,"mat-select",6)(19,"mat-option",7),o(20,"Maschio"),i(),r(21,"mat-option",8),o(22,"Femmina"),i()(),p(23,it,2,0,"mat-error",4),i(),r(24,"mat-form-field",2)(25,"mat-label"),o(26,"Status"),i(),r(27,"mat-select",9)(28,"mat-option",10),o(29,"Attivo"),i(),r(30,"mat-option",11),o(31,"Inattivo"),i()(),p(32,rt,2,0,"mat-error",4),i()(),r(33,"mat-dialog-actions",12)(34,"button",13),o(35,"Annulla"),i(),r(36,"button",14),p(37,nt,1,0,"mat-spinner",15)(38,ot,2,0,"span",4),i()()()),n&2){let m,d,ie,re,ne;l(),E(a.data.title),l(),s("formGroup",a.userForm),l(6),s("ngIf",(m=a.userForm.get("name"))==null?null:m.hasError("required")),l(5),s("ngIf",(d=a.userForm.get("email"))==null?null:d.hasError("required")),l(),s("ngIf",(ie=a.userForm.get("email"))==null?null:ie.hasError("email")),l(9),s("ngIf",(re=a.userForm.get("gender"))==null?null:re.hasError("required")),l(9),s("ngIf",(ne=a.userForm.get("status"))==null?null:ne.hasError("required")),l(4),s("disabled",a.userForm.invalid||a.isSubmitting),l(),s("ngIf",a.isSubmitting),l(),s("ngIf",!a.isSubmitting)}},dependencies:[y,U,P,w,D,I,T,de,F,L,Ge,Oe,Ne,Be,ke,N,O,G,B,k,fe,q,A,te,ee,Z,Q,$,V],styles:[".full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}mat-dialog-content[_ngcontent-%COMP%]{min-width:350px;max-width:500px;padding-top:10px}.spinner-button[_ngcontent-%COMP%]{display:inline-block;margin-right:8px;vertical-align:middle}"]})};var at=()=>[5,10,20],mt=(e,t)=>({"active-status":e,"inactive-status":t});function lt(e,t){e&1&&(r(0,"div",12),u(1,"mat-spinner",13),i())}function st(e,t){e&1&&(r(0,"th",28),o(1," ID "),i())}function pt(e,t){if(e&1&&(r(0,"td",29),o(1),i()),e&2){let n=t.$implicit;l(),M(" ",n.id," ")}}function dt(e,t){e&1&&(r(0,"th",28),o(1," Nome "),i())}function ct(e,t){if(e&1&&(r(0,"td",29),o(1),i()),e&2){let n=t.$implicit;l(),M(" ",n.name," ")}}function ut(e,t){e&1&&(r(0,"th",28),o(1," Email "),i())}function ft(e,t){if(e&1&&(r(0,"td",29),o(1),i()),e&2){let n=t.$implicit;l(),M(" ",n.email," ")}}function _t(e,t){e&1&&(r(0,"th",28),o(1," Genere "),i())}function gt(e,t){if(e&1&&(r(0,"td",29),o(1),i()),e&2){let n=t.$implicit;l(),M(" ",n.gender," ")}}function ht(e,t){e&1&&(r(0,"th",28),o(1," Stato "),i())}function Ct(e,t){if(e&1&&(r(0,"td",29)(1,"span",30),o(2),i()()),e&2){let n=t.$implicit;l(),s("ngClass",le(2,mt,n.status==="active",n.status==="inactive")),l(),E(n.status)}}function vt(e,t){e&1&&(r(0,"th",31),o(1," Azioni "),i())}function St(e,t){if(e&1){let n=W();r(0,"td",29)(1,"button",32),f("click",function(){let m=v(n).$implicit,d=h(2);return S(d.viewUserDetails(m.id))}),r(2,"mat-icon"),o(3,"visibility"),i()(),r(4,"button",33),f("click",function(){let m=v(n).$implicit,d=h(2);return S(d.editUser(m))}),r(5,"mat-icon"),o(6,"edit"),i()(),r(7,"button",34),f("click",function(){let m=v(n).$implicit,d=h(2);return S(d.deleteUser(m.id))}),r(8,"mat-icon"),o(9,"delete"),i()()()}}function Mt(e,t){e&1&&u(0,"tr",35)}function xt(e,t){e&1&&u(0,"tr",36)}function bt(e,t){e&1&&(r(0,"tr",37)(1,"td",38),o(2,"Nessun utente trovato"),i()())}function Et(e,t){if(e&1){let n=W();r(0,"div")(1,"table",14),_(2,15),p(3,st,2,0,"th",16)(4,pt,2,1,"td",17),g(),_(5,18),p(6,dt,2,0,"th",16)(7,ct,2,1,"td",17),g(),_(8,19),p(9,ut,2,0,"th",16)(10,ft,2,1,"td",17),g(),_(11,20),p(12,_t,2,0,"th",16)(13,gt,2,1,"td",17),g(),_(14,21),p(15,ht,2,0,"th",16)(16,Ct,3,5,"td",17),g(),_(17,22),p(18,vt,2,0,"th",23)(19,St,10,0,"td",17),g(),p(20,Mt,1,0,"tr",24)(21,xt,1,0,"tr",25)(22,bt,3,0,"tr",26),i(),r(23,"mat-paginator",27),f("page",function(m){v(n);let d=h();return S(d.onPageChange(m))}),i()()}if(e&2){let n=h();l(),s("dataSource",n.dataSource),l(19),s("matHeaderRowDef",n.displayedColumns),l(),s("matRowDefColumns",n.displayedColumns),l(2),s("pageSizeOptions",me(5,at))("pageSize",20)}}var Ve=class e{constructor(t,n,a,m,d){this.userService=t;this.fb=n;this.dialog=a;this.snackBar=m;this.router=d}users=[];dataSource=new Fe([]);displayedColumns=["id","name","email","gender","status","actions"];searchForm;loading=!1;totalUsers=0;perPage=20;paginator;sort;ngOnInit(){this.initSearchForm(),this.loadUsers()}initSearchForm(){this.searchForm=this.fb.group({name:[""],email:[""]})}loadUsers(t=1){let{name:n,email:a}=this.searchForm.value;this.loading=!0,this.userService.getUsers(t,this.perPage,n,a).pipe(ae(()=>this.loading=!1)).subscribe({next:m=>{this.users=m,this.dataSource.data=m,setTimeout(()=>{this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})},error:m=>{console.error("Errore nel caricamento degli utenti",m),this.snackBar.open("Errore nel caricamento degli utenti","Chiudi",{duration:3e3})}})}onSearch(){this.loadUsers()}resetSearch(){this.searchForm.reset(),this.loadUsers()}viewUserDetails(t){this.router.navigate(["/users",t])}createUser(){this.dialog.open(x,{width:"500px",data:{title:"Crea Nuovo Utente"}}).afterClosed().subscribe(n=>{n&&this.loadUsers()})}editUser(t){this.dialog.open(x,{width:"500px",data:{title:"Modifica Utente",user:oe({},t)}}).afterClosed().subscribe(a=>{a&&this.loadUsers()})}deleteUser(t){confirm("Sei sicuro di voler eliminare questo utente?")&&this.userService.deleteUser(t).subscribe({next:()=>{this.snackBar.open("Utente eliminato con successo","Chiudi",{duration:3e3}),this.loadUsers()},error:n=>{console.error("Errore durante l'eliminazione dell'utente",n),this.snackBar.open("Errore durante l'eliminazione dell'utente","Chiudi",{duration:3e3})}})}onPageChange(t){this.loadUsers(t.pageIndex+1)}static \u0275fac=function(n){return new(n||e)(c(Y),c(R),c(Pe),c(z),c(pe))};static \u0275cmp=b({type:e,selectors:[["app-user-list"]],viewQuery:function(n,a){if(n&1&&(J(j,5),J(H,5)),n&2){let m;K(m=X())&&(a.paginator=m.first),K(m=X())&&(a.sort=m.first)}},decls:30,vars:3,consts:[[1,"search-form",3,"ngSubmit","formGroup"],[1,"search-fields"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Cerca per nome"],["matInput","","formControlName","email","placeholder","Cerca per email"],[1,"search-buttons"],["mat-raised-button","","color","primary","type","submit"],["mat-button","","type","button",3,"click"],[1,"add-user-button"],["mat-raised-button","","color","accent",3,"click"],["class","loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"loading-spinner"],["diameter","40"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","name"],["matColumnDef","email"],["matColumnDef","gender"],["matColumnDef","status"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","Visualizza dettagli",3,"click"],["mat-icon-button","","color","accent","matTooltip","Modifica utente",3,"click"],["mat-icon-button","","color","warn","matTooltip","Elimina utente",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","6",1,"mat-cell"]],template:function(n,a){n&1&&(r(0,"h1"),o(1,"Gestione Utenti"),i(),r(2,"p"),o(3,"Visualizza, cerca, crea e gestisci gli utenti"),i(),r(4,"form",0),f("ngSubmit",function(){return a.onSearch()}),r(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),o(8,"Nome"),i(),u(9,"input",3),i(),r(10,"mat-form-field",2)(11,"mat-label"),o(12,"Email"),i(),u(13,"input",4),i(),r(14,"div",5)(15,"button",6)(16,"mat-icon"),o(17,"search"),i(),o(18," Cerca "),i(),r(19,"button",7),f("click",function(){return a.resetSearch()}),r(20,"mat-icon"),o(21,"clear"),i(),o(22," Reset "),i()()()(),r(23,"div",8)(24,"button",9),f("click",function(){return a.createUser()}),r(25,"mat-icon"),o(26,"add"),i(),o(27," Nuovo Utente "),i()(),p(28,lt,2,0,"div",10)(29,Et,24,6,"div",11)),n&2&&(l(4),s("formGroup",a.searchForm),l(24),s("ngIf",a.loading),l(),s("ngIf",!a.loading))},dependencies:[y,se,U,P,w,D,I,T,F,L,N,O,ce,ue,G,B,k,V,_e,q,A,ge,j,Q,$,Ce,H,he,we,ve,Me,Ue,xe,Se,ye,be,Ee,De,Ie,Te],styles:[".user-list-container[_ngcontent-%COMP%]{padding:20px}.search-form[_ngcontent-%COMP%]{margin-bottom:20px}.search-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;align-items:center}.search-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.add-user-button[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;justify-content:flex-end}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:40px 0}.users-table-container[_ngcontent-%COMP%]{max-height:600px;overflow:auto}table[_ngcontent-%COMP%]{width:100%}.mat-column-actions[_ngcontent-%COMP%]{width:160px;text-align:center}.mat-column-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-flex;margin:0 4px}.active-status[_ngcontent-%COMP%]{color:green;font-weight:500}.inactive-status[_ngcontent-%COMP%]{color:red;font-weight:500}@media (max-width: 768px){.search-fields[_ngcontent-%COMP%]{flex-direction:column;gap:0;width:100%}mat-form-field[_ngcontent-%COMP%]{width:100%}}"]})};export{Ve as UserListComponent};
