import{a as lt}from"./chunk-D7SAFOPG.js";import{a as at}from"./chunk-4QPLJO73.js";import{a as it,b as rt,c as mt}from"./chunk-TZWS5AQ3.js";import{$a as O,Ab as U,Bb as j,Cb as q,G as P,H as b,Ha as i,Ia as f,Ka as S,Vc as ot,W as m,Xa as I,Ya as E,Zb as V,_ as d,aa as h,bc as z,dc as R,ec as A,fa as p,fc as G,gc as L,ha as l,hc as H,ic as $,jb as y,kc as J,lb as F,lc as K,mc as Q,nc as W,qa as e,qb as D,ra as t,rb as _,s as v,sa as u,sc as X,tb as k,tc as Y,ub as w,uc as Z,vc as tt,wa as M,wb as B,ya as C,yb as T,yc as et,za as g,zb as N,zc as nt}from"./chunk-TLH5L5OP.js";function st(r,o){r&1&&(e(0,"div",6),u(1,"mat-spinner",7),t())}function dt(r,o){if(r&1&&(e(0,"mat-card-subtitle")(1,"span",24),i(2,"Autore:"),t(),i(3),t()),r&2){let n=g(2);m(3),S(" ",n.user.name," (",n.user.email,") ")}}function pt(r,o){r&1&&(e(0,"mat-error"),i(1,"Il nome \xE8 obbligatorio"),t())}function ut(r,o){r&1&&(e(0,"mat-error"),i(1,"L'email \xE8 obbligatoria"),t())}function ft(r,o){r&1&&(e(0,"mat-error"),i(1,"Inserisci un'email valida"),t())}function gt(r,o){r&1&&(e(0,"mat-error"),i(1,"Il commento \xE8 obbligatorio"),t())}function _t(r,o){r&1&&(e(0,"div",6),u(1,"mat-spinner",25),t())}function vt(r,o){r&1&&(e(0,"div",26)(1,"mat-icon"),i(2,"comment"),t(),e(3,"p"),i(4,"Nessun commento presente. Sii il primo a commentare!"),t()())}function Ct(r,o){if(r&1&&(e(0,"mat-card",27)(1,"mat-card-header")(2,"div",9)(3,"mat-icon"),i(4,"person"),t()(),e(5,"mat-card-title"),i(6),t(),e(7,"mat-card-subtitle"),i(8),t()(),e(9,"mat-card-content")(10,"p"),i(11),t()()()),r&2){let n=o.$implicit;m(6),f(n.name),m(2),f(n.email),m(3),f(n.body)}}function xt(r,o){if(r&1){let n=M();e(0,"div")(1,"mat-card",8)(2,"mat-card-header")(3,"div",9)(4,"mat-icon"),i(5,"article"),t()(),e(6,"mat-card-title"),i(7),t(),p(8,dt,4,2,"mat-card-subtitle",4),t(),e(9,"mat-card-content")(10,"p",10),i(11),t()()(),e(12,"div",11)(13,"h2"),i(14,"Commenti"),t(),e(15,"mat-card",12)(16,"mat-card-header")(17,"mat-card-title"),i(18,"Aggiungi un commento"),t()(),e(19,"mat-card-content")(20,"form",13),C("ngSubmit",function(){P(n);let s=g();return b(s.submitComment())}),e(21,"div",14)(22,"mat-form-field",15)(23,"mat-label"),i(24,"Nome"),t(),u(25,"input",16),p(26,pt,2,0,"mat-error",4),t(),e(27,"mat-form-field",15)(28,"mat-label"),i(29,"Email"),t(),u(30,"input",17),p(31,ut,2,0,"mat-error",4)(32,ft,2,0,"mat-error",4),t()(),e(33,"mat-form-field",18)(34,"mat-label"),i(35,"Commento"),t(),u(36,"textarea",19),p(37,gt,2,0,"mat-error",4),t(),e(38,"button",20)(39,"mat-icon"),i(40,"send"),t(),i(41," Invia commento "),t()()()(),e(42,"div",21),p(43,_t,2,0,"div",3)(44,vt,5,0,"div",22)(45,Ct,12,3,"mat-card",23),t()()()}if(r&2){let n,c,s,x,a=g();m(7),f(a.post.title),m(),l("ngIf",a.user),m(3),f(a.post.body),m(9),l("formGroup",a.commentForm),m(6),l("ngIf",(n=a.commentForm.get("name"))==null?null:n.hasError("required")),m(5),l("ngIf",(c=a.commentForm.get("email"))==null?null:c.hasError("required")),m(),l("ngIf",(s=a.commentForm.get("email"))==null?null:s.hasError("email")),m(5),l("ngIf",(x=a.commentForm.get("body"))==null?null:x.hasError("required")),m(),l("disabled",a.commentForm.invalid),m(5),l("ngIf",a.loadingComments),m(),l("ngIf",!a.loadingComments&&a.comments.length===0),m(),l("ngForOf",a.comments)}}function Pt(r,o){if(r&1){let n=M();e(0,"div",28)(1,"mat-icon"),i(2,"error"),t(),e(3,"h2"),i(4,"Post non trovato"),t(),e(5,"p"),i(6,"Il post che stai cercando non esiste o \xE8 stato rimosso."),t(),e(7,"button",29),C("click",function(){P(n);let s=g();return b(s.goBack())}),i(8," Torna alla lista dei post "),t()()}}var ct=class r{constructor(o,n,c,s,x,a,bt){this.route=o;this.router=n;this.postService=c;this.commentService=s;this.userService=x;this.fb=a;this.snackBar=bt}postId;post=null;comments=[];user=null;loadingPost=!1;loadingComments=!1;loadingUser=!1;commentForm;ngOnInit(){this.initCommentForm(),this.route.paramMap.subscribe(o=>{let n=o.get("id");n?(this.postId=+n,this.loadPostDetails(),this.loadComments()):this.router.navigate(["/posts"])})}initCommentForm(){this.commentForm=this.fb.group({name:["",_.required],email:["",[_.required,_.email]],body:["",_.required]})}loadPostDetails(){this.loadingPost=!0,this.postService.getPostById(this.postId).pipe(v(()=>this.loadingPost=!1)).subscribe({next:o=>{this.post=o,this.loadUserDetails(o.user_id)},error:o=>{console.error("Errore nel caricamento dei dettagli del post",o),this.snackBar.open("Errore nel caricamento dei dettagli del post","Chiudi",{duration:3e3}),this.router.navigate(["/posts"])}})}loadUserDetails(o){this.loadingUser=!0,this.userService.getUserById(o).pipe(v(()=>this.loadingUser=!1)).subscribe({next:n=>{this.user=n},error:n=>{console.error("Errore nel caricamento dei dettagli dell'utente",n)}})}loadComments(){this.loadingComments=!0,this.commentService.getPostComments(this.postId).pipe(v(()=>this.loadingComments=!1)).subscribe({next:o=>{this.comments=o},error:o=>{console.error("Errore nel caricamento dei commenti",o),this.snackBar.open("Errore nel caricamento dei commenti","Chiudi",{duration:3e3})}})}submitComment(){if(this.commentForm.valid){let o={post_id:this.postId,name:this.commentForm.value.name,email:this.commentForm.value.email,body:this.commentForm.value.body};this.commentService.createComment(o).subscribe({next:n=>{this.comments.unshift(n),this.commentForm.reset(),this.snackBar.open("Commento aggiunto con successo","Chiudi",{duration:3e3})},error:n=>{console.error("Errore durante l'aggiunta del commento",n),this.snackBar.open("Errore durante l'aggiunta del commento","Chiudi",{duration:3e3})}})}}goBack(){this.router.navigate(["/posts"])}static \u0275fac=function(n){return new(n||r)(d(y),d(F),d(at),d(lt),d(mt),d(j),d(ot))};static \u0275cmp=h({type:r,selectors:[["app-post-detail"]],decls:10,vars:3,consts:[[1,"post-detail-container"],[1,"back-button"],["mat-icon-button","","color","primary",3,"click"],["class","loading-spinner",4,"ngIf"],[4,"ngIf"],["class","not-found",4,"ngIf"],[1,"loading-spinner"],["diameter","40"],[1,"post-card"],["mat-card-avatar","",1,"avatar"],[1,"post-content"],[1,"comments-section"],[1,"comment-form-card"],[1,"comment-form",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"form-field"],["matInput","","formControlName","name","placeholder","Il tuo nome","required",""],["matInput","","formControlName","email","placeholder","La tua email","required",""],["appearance","outline",1,"full-width"],["matInput","","formControlName","body","rows","4","placeholder","Scrivi il tuo commento","required",""],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"comments-list"],["class","no-comments",4,"ngIf"],["class","comment-card",4,"ngFor","ngForOf"],[1,"subtitle-label"],["diameter","30"],[1,"no-comments"],[1,"comment-card"],[1,"not-found"],["mat-raised-button","","color","primary",3,"click"]],template:function(n,c){n&1&&(e(0,"div",0)(1,"div",1)(2,"button",2),C("click",function(){return c.goBack()}),e(3,"mat-icon"),i(4,"arrow_back"),t()(),e(5,"span"),i(6,"Torna alla lista dei post"),t()(),p(7,st,2,0,"div",3)(8,xt,46,12,"div",4)(9,Pt,9,0,"div",5),t()),n&2&&(m(7),l("ngIf",c.loadingPost),m(),l("ngIf",!c.loadingPost&&c.post),m(),l("ngIf",!c.loadingPost&&!c.post))},dependencies:[O,I,E,q,B,D,k,w,U,T,N,R,z,V,K,A,J,L,$,H,G,Y,X,Q,W,tt,Z,nt,et,rt,it],styles:[".post-detail-container[_ngcontent-%COMP%]{padding:20px;max-width:900px;margin:0 auto}.back-button[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:20px;gap:10px}.back-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:16px}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:40px 0}.post-card[_ngcontent-%COMP%]{margin-bottom:30px;box-shadow:0 4px 6px #0000001a}.post-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-color:#f5f5f5;display:flex;justify-content:center;align-items:center}.post-card[_ngcontent-%COMP%]   .post-content[_ngcontent-%COMP%]{margin-top:20px;line-height:1.6;white-space:pre-line}.post-card[_ngcontent-%COMP%]   .subtitle-label[_ngcontent-%COMP%]{font-weight:700}.comments-section[_ngcontent-%COMP%]{margin-top:40px}.comments-section[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-bottom:20px;font-size:24px;font-weight:500;color:#333}.comment-form-card[_ngcontent-%COMP%]{margin-bottom:30px}.comment-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:15px}.comment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{display:flex;gap:15px}.comment-form[_ngcontent-%COMP%]   .form-field[_ngcontent-%COMP%]{flex:1}.comment-form[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.comment-form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{align-self:flex-start}.comments-list[_ngcontent-%COMP%]{margin-top:30px}.comment-card[_ngcontent-%COMP%]{margin-bottom:20px;background-color:#f9f9f9}.comment-card[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-color:#e0e0e0;display:flex;justify-content:center;align-items:center}.comment-card[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:10px;line-height:1.5}.no-comments[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:40px 0;color:#757575}.no-comments[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;height:48px;width:48px;margin-bottom:15px}.no-comments[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px}.not-found[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin:60px 0;text-align:center}.not-found[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:64px;height:64px;width:64px;margin-bottom:20px;color:#f44336}.not-found[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:28px;margin-bottom:15px}.not-found[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:18px;color:#757575;margin-bottom:30px}@media (max-width: 768px){.comment-form[_ngcontent-%COMP%]   .form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}}"]})};export{ct as PostDetailComponent};
