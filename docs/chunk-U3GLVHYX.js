import{a as w,b as at,c as x,d as mt,e as st,f as lt,g as pt,h as ct,i as dt,j as ut,k as ft,l as _t,m as gt,n as ht,o as Ct,p as Pt,q as vt,r as wt,s as bt}from"./chunk-2KFCE3JQ.js";import"./chunk-EVKU2CPO.js";import{a as yt}from"./chunk-WEVPAXWS.js";import{a as xt,b as St,c as Mt}from"./chunk-BC6DZUWT.js";import{Ab as G,Bb as j,Ca as S,Da as M,Ea as b,G as _,Ga as r,H as g,Ia as y,La as I,Tc as rt,W as s,Xa as D,Yb as q,_ as d,_a as N,aa as E,ac as Q,cc as $,dc as A,ea as f,ec as U,fc as J,ga as l,hc as K,kb as T,kc as W,lc as X,nc as Y,pa as o,pb as L,qa as i,ra as p,rc as Z,s as F,sa as C,sb as O,sc as tt,ta as P,tb as R,tc as et,uc as it,va as v,vb as k,wb as V,xa as c,xb as B,xc as ot,ya as u,yb as z,yc as nt,zb as H}from"./chunk-DJCM6767.js";var Et=()=>[5,10,20];function It(t,n){if(t&1){let e=v();o(0,"div",12)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),r(4,"Crea nuovo post"),i()(),o(5,"mat-card-content")(6,"form",13),c("ngSubmit",function(){_(e);let m=u();return g(m.submitNewPost())}),o(7,"mat-form-field",14)(8,"mat-label"),r(9,"ID Utente"),i(),p(10,"input",15),o(11,"mat-hint"),r(12,"Inserisci l'ID dell'utente a cui appartiene il post"),i()(),o(13,"mat-form-field",14)(14,"mat-label"),r(15,"Titolo"),i(),p(16,"input",16),i(),o(17,"mat-form-field",14)(18,"mat-label"),r(19,"Contenuto"),i(),p(20,"textarea",17),i(),o(21,"div",18)(22,"button",19),r(23," Pubblica Post "),i(),o(24,"button",6),c("click",function(){_(e);let m=u();return g(m.toggleNewPostForm())}),r(25," Annulla "),i()()()()()()}if(t&2){let e=u();s(6),l("formGroup",e.newPostForm),s(16),l("disabled",e.newPostForm.invalid)}}function Dt(t,n){t&1&&(o(0,"div",20),p(1,"mat-spinner",21),i())}function Nt(t,n){t&1&&(o(0,"th",33),r(1," ID "),i())}function Tt(t,n){if(t&1&&(o(0,"td",34),r(1),i()),t&2){let e=n.$implicit;s(),y(" ",e.id," ")}}function Lt(t,n){t&1&&(o(0,"th",33),r(1," Titolo "),i())}function Ot(t,n){if(t&1&&(o(0,"td",34),r(1),i()),t&2){let e=n.$implicit;s(),y(" ",e.title," ")}}function Rt(t,n){t&1&&(o(0,"th",35),r(1," Azioni "),i())}function kt(t,n){if(t&1){let e=v();o(0,"td",34)(1,"button",36),c("click",function(){let m=_(e).$implicit,h=u(2);return g(h.viewPostDetails(m.id))}),o(2,"mat-icon"),r(3,"visibility"),i()()()}}function Vt(t,n){t&1&&p(0,"tr",37)}function Bt(t,n){t&1&&p(0,"tr",38)}function zt(t,n){t&1&&(o(0,"tr",39)(1,"td",40),r(2,"Nessun post trovato"),i()())}function Ht(t,n){if(t&1){let e=v();o(0,"div")(1,"table",22),C(2,23),f(3,Nt,2,0,"th",24)(4,Tt,2,1,"td",25),P(),C(5,26),f(6,Lt,2,0,"th",24)(7,Ot,2,1,"td",25),P(),C(8,27),f(9,Rt,2,0,"th",28)(10,kt,4,0,"td",25),P(),f(11,Vt,1,0,"tr",29)(12,Bt,1,0,"tr",30)(13,zt,3,0,"tr",31),i(),o(14,"mat-paginator",32),c("page",function(m){_(e);let h=u();return g(h.onPageChange(m))}),i()()}if(t&2){let e=u();s(),l("dataSource",e.dataSource),s(10),l("matHeaderRowDef",e.displayedColumns),s(),l("matRowDefColumns",e.displayedColumns),s(2),l("pageSizeOptions",I(5,Et))("pageSize",20)}}var Ft=class t{constructor(n,e,a,m,h,Gt){this.postService=n;this.userService=e;this.fb=a;this.dialog=m;this.snackBar=h;this.router=Gt}posts=[];dataSource=new wt([]);displayedColumns=["id","title","actions"];searchForm;loading=!1;perPage=20;newPostForm;showNewPostForm=!1;paginator;sort;ngOnInit(){this.initSearchForm(),this.initNewPostForm(),this.loadPosts()}initSearchForm(){this.searchForm=this.fb.group({title:[""]})}initNewPostForm(){this.newPostForm=this.fb.group({title:[""],body:[""],user_id:[""]})}loadPosts(n=1){let{title:e}=this.searchForm.value;this.loading=!0,console.log(`Caricamento post: page=${n}, perPage=${this.perPage}`),this.postService.getPosts(n,this.perPage,e).pipe(F(()=>this.loading=!1)).subscribe({next:a=>{console.log(`Post caricati: ${a.length}`),this.posts=a,this.dataSource.data=a,setTimeout(()=>{this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort})},error:a=>{console.error("Errore nel caricamento dei post",a),this.snackBar.open("Errore nel caricamento dei post","Chiudi",{duration:3e3})}})}onSearch(){this.loadPosts()}resetSearch(){this.searchForm.reset(),this.loadPosts()}viewPostDetails(n){this.router.navigate(["/posts",n])}toggleNewPostForm(){this.showNewPostForm=!this.showNewPostForm,this.showNewPostForm&&this.newPostForm.reset()}submitNewPost(){if(this.newPostForm.valid){let n=this.newPostForm.value;this.postService.createPost(n).subscribe({next:()=>{this.snackBar.open("Post creato con successo","Chiudi",{duration:3e3}),this.toggleNewPostForm(),this.loadPosts()},error:e=>{console.error("Errore durante la creazione del post",e),this.snackBar.open("Errore durante la creazione del post","Chiudi",{duration:3e3})}})}}onPageChange(n){this.perPage=n.pageSize,this.loadPosts(n.pageIndex+1)}static \u0275fac=function(e){return new(e||t)(d(yt),d(Mt),d(G),d(bt),d(rt),d(T))};static \u0275cmp=E({type:t,selectors:[["app-post-list"]],viewQuery:function(e,a){if(e&1&&(S(w,5),S(x,5)),e&2){let m;M(m=b())&&(a.paginator=m.first),M(m=b())&&(a.sort=m.first)}},decls:27,vars:4,consts:[[1,"search-form",3,"ngSubmit","formGroup"],[1,"search-fields"],["appearance","outline"],["matInput","","formControlName","title","placeholder","Cerca per titolo"],[1,"search-buttons"],["mat-raised-button","","color","primary","type","submit"],["mat-button","","type","button",3,"click"],[1,"add-post-button"],["mat-raised-button","","color","accent",3,"click"],["class","new-post-form-container",4,"ngIf"],["class","loading-spinner",4,"ngIf"],[4,"ngIf"],[1,"new-post-form-container"],[1,"new-post-form",3,"ngSubmit","formGroup"],["appearance","outline",1,"full-width"],["matInput","","formControlName","user_id","type","number","required",""],["matInput","","formControlName","title","required",""],["matInput","","formControlName","body","rows","5","required",""],[1,"form-actions"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[1,"loading-spinner"],["diameter","40"],["mat-table","","matSort","",3,"dataSource"],["matColumnDef","id"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","title"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["class","mat-row",4,"matNoDataRow"],["showFirstLastButtons","",3,"page","pageSizeOptions","pageSize"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-header-cell",""],["mat-icon-button","","color","primary",3,"click"],["mat-header-row",""],["mat-row",""],[1,"mat-row"],["colspan","3",1,"mat-cell"]],template:function(e,a){e&1&&(o(0,"h1"),r(1,"Gestione Post"),i(),o(2,"p"),r(3,"Visualizza, cerca e crea post"),i(),o(4,"form",0),c("ngSubmit",function(){return a.onSearch()}),o(5,"div",1)(6,"mat-form-field",2)(7,"mat-label"),r(8,"Titolo"),i(),p(9,"input",3),i(),o(10,"div",4)(11,"button",5)(12,"mat-icon"),r(13,"search"),i(),r(14," Cerca "),i(),o(15,"button",6),c("click",function(){return a.resetSearch()}),o(16,"mat-icon"),r(17,"clear"),i(),r(18," Reset "),i()()()(),o(19,"div",7)(20,"button",8),c("click",function(){return a.toggleNewPostForm()}),o(21,"mat-icon"),r(22,"add"),i(),r(23," Nuovo Post "),i()(),f(24,It,26,2,"div",9)(25,Dt,2,0,"div",10)(26,Ht,15,6,"div",11)),e&2&&(s(4),l("formGroup",a.searchForm),s(20),l("ngIf",a.showNewPostForm),s(),l("ngIf",a.loading),s(),l("ngIf",!a.loading))},dependencies:[N,D,j,k,L,V,O,R,H,B,z,$,Q,q,W,A,J,K,U,tt,Z,X,Y,it,et,nt,ot,at,w,St,xt,st,x,mt,vt,lt,ct,_t,dt,pt,gt,ut,ft,ht,Ct,Pt],styles:[".post-list-container[_ngcontent-%COMP%]{padding:20px}.search-form[_ngcontent-%COMP%]{margin-bottom:20px}.search-fields[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:15px;align-items:center}.search-buttons[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}.add-post-button[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;justify-content:flex-end}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:40px 0}.posts-table-container[_ngcontent-%COMP%]{max-height:600px;overflow:auto}table[_ngcontent-%COMP%]{width:100%}.mat-column-actions[_ngcontent-%COMP%]{width:80px;text-align:center}.new-post-form-container[_ngcontent-%COMP%]{margin-bottom:30px}.new-post-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;margin-top:20px}.full-width[_ngcontent-%COMP%]{width:100%;margin-bottom:15px}.form-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:10px}@media (max-width: 768px){.search-fields[_ngcontent-%COMP%]{flex-direction:column;gap:0;width:100%}mat-form-field[_ngcontent-%COMP%]{width:100%}}"]})};export{Ft as PostListComponent};
